<?php
 goto tfQuH; Atdl3: if ($userRole == "\x61\x64\155\x69\156") { ?>
<li><a href="employee_management.php"><i class="fas fa-user-cog"></i> Personel Yönetimi</a></li><li><a href="department_management.php"class="active"><i class="fas fa-building"></i> Departman Yönetimi</a></li><li><a href="card_management.php"><i class="fas fa-id-card"></i> Kart Yönetimi</a></li><li><a href="reports.php"><i class="fas fa-chart-bar"></i> Raporlar</a></li><?php  } goto eWfMs; L7ZET: $employeesFile = "\144\141\x74\x61\57\145\155\160\x6c\x6f\x79\145\x65\163\56\x6a\163\x6f\156"; goto ilvtK; gckhT: ?>
<div class="card"><div class="align-items-center card-header d-flex justify-content-between"><h5 class="mb-0">Departman Listesi</h5><button class="btn btn-primary"type="button"data-bs-target="#addDepartmentModal"data-bs-toggle="modal"><i class="fas fa-plus"></i> Yeni Departman Ekle</button></div><div class="card-body"><div class="table-responsive"><table class="table table-hover"><thead><tr><th>Departman Adı</th><th>Departman Yöneticisi</th><th>Çalışan Sayısı</th><th>İşlemler</th></tr></thead><tbody><?php  goto NE38i; RQgO3: echo $userName; goto K0qut; eWfMs: ?>
</ul></nav><div class="sidebar-footer"><a href="profile.php"><i class="fas fa-user-circle"></i> Profil</a> <a href="logout.php"><i class="fas fa-sign-out-alt"></i> Çıkış</a></div></aside><main class="main-content"><header class="header"><div class="header-left"><button class="sidebar-toggle"id="sidebar-toggle"><i class="fas fa-bars"></i></button><h2>Departman Yönetimi</h2></div><div class="header-right"><div class="notification"><i class="fas fa-bell"></i> <span class="badge">3</span></div><div class="date-time"><span id="current-date"></span> <span id="current-time"></span></div></div></header><div class="content-wrapper"><div class="container-fluid"><?php  goto iHZP2; rgxUd: $userRole = $_SESSION["\x72\157\x6c\x65"]; goto WWTdO; t3AT7: ?>
</p></div></div><nav class="sidebar-nav"><ul><li><a href="index.php"><i class="fas fa-home"></i> Ana Sayfa</a></li><li><a href="attendance.php"><i class="fas fa-clock"></i> Giriş/Çıkış Kayıtları</a></li><li><a href="leave_requests.php"><i class="fas fa-calendar-alt"></i> İzin Talepleri</a></li><li><a href="advance_requests.php"><i class="fas fa-money-bill-wave"></i> Avans Talepleri</a></li><?php  goto vC0Xn; vC0Xn: if ($userRole == "\155\x61\x6e\141\147\x65\x72") { ?>
<li><a href="team_management.php"><i class="fas fa-users"></i> Ekip Yönetimi</a></li><li><a href="approval_requests.php"><i class="fas fa-tasks"></i> Onay Bekleyen Talepler</a></li><?php  } goto Atdl3; tfQuH: session_start(); goto dN4mz; PAZze: $userName = $_SESSION["\x6e\x61\x6d\x65"]; goto rgxUd; U_QIk: foreach ($managers as $manager) { ?>
<option value="<?php  echo $manager["\x69\x64"]; ?>
"><?php  echo $manager["\x6e\141\x6d\145"]; ?>
(<?php  echo $manager["\160\x6f\163\151\x74\151\x6f\x6e"]; ?>
)</option><?php  } goto obEr1; zD03t: $errorMessage = ''; goto v0hfh; VGGHK: if (!empty($errorMessage)) { ?>
<div class="alert alert-danger"><?php  echo $errorMessage; ?>
</div><?php  } goto gckhT; v0hfh: if ($_SERVER["\122\105\x51\125\x45\123\124\137\x4d\105\124\x48\117\x44"] == "\120\x4f\123\124") { $action = isset($_POST["\141\143\164\x69\157\x6e"]) ? $_POST["\141\143\x74\151\x6f\x6e"] : ''; $employeesFile = "\x64\141\164\x61\x2f\x65\155\x70\154\x6f\x79\145\x65\163\x2e\x6a\163\x6f\156"; $employees = array(); if (file_exists($employeesFile)) { $employees = json_decode(file_get_contents($employeesFile), true); } $departments = array(); foreach ($employees as $employee) { if (!isset($departments[$employee["\x64\x65\x70\x61\162\x74\155\x65\156\164"]])) { $departments[$employee["\x64\145\x70\x61\x72\164\x6d\x65\x6e\x74"]] = array("\x6e\141\155\x65" => $employee["\x64\x65\x70\x61\162\x74\x6d\x65\156\x74"], "\x6d\x61\156\x61\x67\x65\x72\137\151\x64" => null, "\x65\155\x70\x6c\157\171\145\145\x5f\x63\x6f\x75\x6e\x74" => 0); } $departments[$employee["\144\145\x70\141\x72\x74\155\145\x6e\x74"]]["\x65\155\160\x6c\x6f\x79\x65\145\137\143\x6f\x75\x6e\164"]++; if ($employee["\x70\x6f\x73\x69\x74\151\157\x6e"] && strpos(strtolower($employee["\160\x6f\163\151\x74\x69\x6f\x6e"]), "\x6d\xc3\xbc\144\xc3\xbc\x72") !== false) { $departments[$employee["\144\x65\160\141\x72\164\x6d\145\156\x74"]]["\x6d\x61\x6e\141\147\x65\x72\x5f\x69\144"] = $employee["\x69\144"]; $departments[$employee["\x64\145\160\x61\162\x74\155\145\x6e\164"]]["\155\141\x6e\x61\x67\145\162\x5f\x6e\x61\155\x65"] = $employee["\x6e\x61\x6d\x65"]; } } if ($action === "\141\x64\144") { $departmentName = $_POST["\144\x65\160\141\x72\164\x6d\145\156\164\137\x6e\x61\155\x65"]; $managerId = !empty($_POST["\155\141\156\x61\x67\145\x72\x5f\x69\x64"]) ? (int) $_POST["\x6d\141\x6e\x61\x67\145\162\x5f\x69\x64"] : null; if (isset($departments[$departmentName])) { $errorMessage = "\x42\165\40\144\145\160\141\162\x74\x6d\141\x6e\40\172\141\x74\145\156\40\155\x65\166\143\x75\164\x2e"; } else { if ($managerId) { foreach ($employees as &$employee) { if ($employee["\x69\144"] === $managerId) { $employee["\x64\x65\x70\x61\x72\164\155\145\x6e\x74"] = $departmentName; break; } } file_put_contents($employeesFile, json_encode($employees, JSON_PRETTY_PRINT)); $usersFile = "\x64\141\x74\x61\x2f\165\163\x65\162\163\56\x6a\x73\157\x6e"; if (file_exists($usersFile)) { $users = json_decode(file_get_contents($usersFile), true); foreach ($users as &$user) { if ($user["\x69\144"] === $managerId) { $user["\144\x65\160\141\x72\164\x6d\145\x6e\x74"] = $departmentName; break; } } file_put_contents($usersFile, json_encode($users, JSON_PRETTY_PRINT)); } $successMessage = "\x44\145\x70\141\x72\x74\x6d\x61\156\x20\142\141\xc5\x9f\141\162\304\261\171\x6c\x61\x20\x65\x6b\x6c\x65\x6e\x64\x69\x2e"; } else { $errorMessage = "\104\x65\x70\x61\x72\x74\155\x61\156\40\151\303\247\x69\x6e\40\x62\151\162\40\171\xc3\266\156\145\x74\x69\143\x69\40\163\145\303\xa7\x6d\145\x6c\x69\163\151\156\x69\x7a\56"; } } } elseif ($action === "\145\144\151\x74") { $oldDepartmentName = $_POST["\x6f\154\x64\137\x64\x65\x70\x61\162\x74\155\145\x6e\x74\x5f\x6e\141\x6d\145"]; $newDepartmentName = $_POST["\144\145\x70\x61\x72\164\x6d\x65\156\x74\x5f\156\141\155\145"]; $managerId = !empty($_POST["\x6d\x61\x6e\141\x67\145\x72\137\151\144"]) ? (int) $_POST["\x6d\141\156\x61\147\x65\162\x5f\151\144"] : null; if ($oldDepartmentName !== $newDepartmentName && isset($departments[$newDepartmentName])) { $errorMessage = "\102\x75\x20\144\145\x70\141\162\164\x6d\141\x6e\x20\141\144\304\xb1\x20\x7a\141\164\x65\x6e\x20\x6d\145\x76\143\165\x74\56"; } else { $updated = false; foreach ($employees as &$employee) { if ($employee["\144\x65\160\141\162\164\x6d\x65\x6e\164"] === $oldDepartmentName) { $employee["\144\145\x70\141\162\164\x6d\x65\156\x74"] = $newDepartmentName; $updated = true; } if ($managerId && $employee["\x69\144"] === $managerId) { $employee["\x64\x65\160\141\x72\164\155\x65\156\x74"] = $newDepartmentName; } } if ($updated) { file_put_contents($employeesFile, json_encode($employees, JSON_PRETTY_PRINT)); $usersFile = "\x64\141\164\141\x2f\x75\x73\x65\x72\163\56\152\x73\157\156"; if (file_exists($usersFile)) { $users = json_decode(file_get_contents($usersFile), true); foreach ($users as &$user) { if ($user["\144\x65\x70\x61\x72\x74\155\x65\156\164"] === $oldDepartmentName) { $user["\144\x65\160\141\162\164\x6d\145\x6e\x74"] = $newDepartmentName; } } file_put_contents($usersFile, json_encode($users, JSON_PRETTY_PRINT)); } $successMessage = "\104\x65\160\x61\x72\164\x6d\x61\x6e\x20\142\141\xc5\237\x61\162\xc4\xb1\x79\x6c\x61\x20\x67\303\xbc\x6e\143\145\154\154\x65\156\144\x69\56"; } else { $errorMessage = "\104\145\x70\x61\162\164\x6d\141\x6e\40\142\165\154\x75\x6e\141\x6d\141\x64\304\261\x2e"; } } } elseif ($action === "\x64\x65\x6c\x65\164\145") { $departmentName = $_POST["\144\145\160\141\x72\164\x6d\145\156\164\137\x6e\141\155\x65"]; $hasEmployees = false; foreach ($employees as $employee) { if ($employee["\x64\145\160\x61\162\164\155\x65\x6e\x74"] === $departmentName) { $hasEmployees = true; break; } } if ($hasEmployees) { $errorMessage = "\x42\x75\x20\144\145\160\x61\162\164\155\x61\156\x64\141\x20\303\xa7\x61\x6c\xc4\xb1\305\x9f\141\x6e\154\x61\162\x20\166\x61\x72\56\x20\303\226\156\x63\x65\40\xc3\247\x61\154\xc4\261\xc5\237\141\156\154\141\162\304\xb1\40\142\141\305\x9f\153\141\40\x64\145\x70\141\x72\164\x6d\x61\x6e\x6c\x61\162\x61\40\141\153\164\141\x72\304\xb1\156\56"; } else { $successMessage = "\104\x65\160\x61\x72\164\155\141\156\40\142\x61\305\237\141\162\xc4\xb1\171\154\x61\x20\x73\151\154\151\156\x64\x69\x2e"; } } $departments = array(); foreach ($employees as $employee) { if (!isset($departments[$employee["\x64\145\160\x61\x72\164\x6d\x65\x6e\x74"]])) { $departments[$employee["\x64\145\x70\x61\162\164\x6d\x65\x6e\164"]] = array("\x6e\x61\x6d\x65" => $employee["\x64\145\x70\x61\x72\x74\x6d\x65\156\x74"], "\x6d\141\156\x61\147\x65\x72\x5f\151\144" => null, "\x65\155\160\154\x6f\171\145\145\x5f\x63\157\165\156\164" => 0); } $departments[$employee["\144\145\160\x61\162\x74\x6d\145\x6e\164"]]["\x65\x6d\160\x6c\x6f\x79\x65\x65\137\143\157\165\x6e\x74"]++; if ($employee["\160\x6f\x73\151\x74\151\x6f\156"] && strpos(strtolower($employee["\160\x6f\163\x69\x74\x69\157\156"]), "\155\xc3\274\x64\xc3\274\x72") !== false) { $departments[$employee["\144\145\x70\141\162\164\155\145\x6e\164"]]["\x6d\141\156\x61\147\145\x72\x5f\151\144"] = $employee["\151\x64"]; $departments[$employee["\x64\x65\x70\141\162\x74\x6d\x65\156\x74"]]["\155\141\x6e\x61\147\145\162\x5f\x6e\x61\x6d\x65"] = $employee["\x6e\141\x6d\145"]; } } } goto L7ZET; b59af: ?>
</tbody></table></div></div></div></div></div></main></div><div class="fade modal"id="addDepartmentModal"aria-hidden="true"aria-labelledby="addDepartmentModalLabel"tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"id="addDepartmentModalLabel">Yeni Departman Ekle</h5><button class="btn-close"type="button"data-bs-dismiss="modal"aria-label="Close"></button></div><form action=""method="post"><div class="modal-body"><input name="action"type="hidden"value="add"><div class="mb-3"><label class="form-label"for="department_name">Departman Adı</label> <input name="department_name"id="department_name"class="form-control"required></div><div class="mb-3"><label class="form-label"for="manager_id">Departman Yöneticisi</label> <select class="form-select"id="manager_id"name="manager_id"required><option value="">Yönetici Seçin</option><?php  goto vxpNi; iHZP2: if (!empty($successMessage)) { ?>
<div class="alert alert-success"><?php  echo $successMessage; ?>
</div><?php  } goto VGGHK; J6toS: if ($_SESSION["\x72\x6f\154\x65"] !== "\x61\x64\x6d\151\156") { header("\114\157\143\141\164\x69\157\x6e\x3a\x20\x69\x6e\144\145\170\x2e\x70\x68\x70"); die; } goto NZI9X; BzxbP: ?>
<!doctypehtml><html lang="tr"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>HRMS - Departman Yönetimi</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"rel="stylesheet"><link href="css/style.css"rel="stylesheet"></head><body><div class="app-container"><aside class="sidebar"><div class="sidebar-header"><img alt="HRMS Logo"src="img/logo.png"class="logo"><h3>HRMS</h3></div><div class="user-info"><div class="user-avatar"><img alt="User Avatar"src="img/avatars/default.png"></div><div class="user-details"><h4><?php  goto RQgO3; K0qut: ?>
</h4><p><?php  goto zNjdI; dCd_G: if (file_exists($employeesFile)) { $employees = json_decode(file_get_contents($employeesFile), true); foreach ($employees as $employee) { if (!isset($departments[$employee["\144\x65\x70\x61\x72\x74\x6d\145\x6e\164"]])) { $departments[$employee["\144\145\160\x61\162\164\x6d\x65\x6e\x74"]] = array("\x6e\141\x6d\x65" => $employee["\x64\x65\x70\x61\162\x74\x6d\x65\x6e\x74"], "\x6d\141\x6e\141\x67\x65\162\137\x69\x64" => null, "\x6d\141\x6e\x61\147\145\x72\137\x6e\141\155\x65" => "\102\x65\x6c\151\162\x74\151\154\155\x65\x6d\x69\305\x9f", "\x65\155\160\154\x6f\171\x65\x65\137\143\x6f\x75\x6e\x74" => 0); } $departments[$employee["\x64\x65\160\141\162\164\155\x65\x6e\164"]]["\x65\155\x70\154\157\171\x65\x65\137\x63\157\165\x6e\164"]++; if ($employee["\160\157\x73\x69\x74\151\x6f\x6e"] && strpos(strtolower($employee["\160\x6f\x73\x69\164\151\157\x6e"]), "\155\303\xbc\x64\xc3\274\x72") !== false) { $departments[$employee["\x64\x65\160\x61\x72\x74\x6d\x65\156\164"]]["\155\x61\x6e\141\147\145\162\x5f\x69\144"] = $employee["\151\144"]; $departments[$employee["\144\145\x70\141\x72\x74\x6d\145\x6e\x74"]]["\155\141\x6e\141\147\x65\x72\137\156\x61\155\145"] = $employee["\156\141\x6d\145"]; } } ksort($departments); } goto B1Ju3; NZI9X: $userId = $_SESSION["\x75\163\x65\x72\x5f\x69\x64"]; goto PAZze; WWTdO: $successMessage = ''; goto zD03t; zCjkD: $departments = array(); goto dCd_G; JwqU3: foreach ($employees as $employee) { if (isset($employee["\x72\157\154\145"]) && ($employee["\162\x6f\154\145"] === "\x6d\141\x6e\141\x67\x65\162" || $employee["\162\x6f\154\x65"] === "\141\x64\x6d\151\156")) { $managers[] = $employee; } else { if (isset($employee["\160\157\163\151\x74\x69\x6f\156"]) && (strpos(strtolower($employee["\x70\x6f\x73\151\x74\x69\157\156"]), "\155\303\274\x64\303\xbc\162") !== false || strpos(strtolower($employee["\x70\x6f\x73\x69\x74\x69\x6f\156"]), "\x79\303\xb6\156\x65\164\151\x63\x69") !== false)) { $managers[] = $employee; } } } goto BzxbP; NE38i: foreach ($departments as $dept) { ?>
<tr><td><?php  echo $dept["\x6e\x61\x6d\145"]; ?>
</td><td><?php  echo $dept["\155\141\156\141\x67\145\162\x5f\x6e\x61\x6d\145"] ?? "\x42\145\154\151\x72\x74\x69\x6c\x6d\x65\x6d\151\305\x9f"; ?>
</td><td><?php  echo $dept["\x65\x6d\x70\x6c\x6f\171\145\145\x5f\143\157\x75\x6e\164"]; ?>
</td><td><button class="btn btn-sm btn-warning"type="button"data-bs-target="#editDepartmentModal"data-bs-toggle="modal"data-name="<?php  echo $dept["\156\x61\x6d\x65"]; ?>
"data-manager-id="<?php  echo $dept["\x6d\x61\x6e\141\147\145\162\137\151\144"]; ?>
"><i class="fas fa-edit"></i></button> <button class="btn btn-danger btn-sm"type="button"data-bs-target="#deleteDepartmentModal"data-bs-toggle="modal"data-name="<?php  echo $dept["\156\x61\x6d\145"]; ?>
"data-count="<?php  echo $dept["\x65\x6d\160\154\x6f\x79\145\x65\x5f\143\x6f\165\156\164"]; ?>
"><i class="fas fa-trash"></i></button></td></tr><?php  } goto b59af; B1Ju3: $managers = array(); goto JwqU3; dN4mz: if (!isset($_SESSION["\165\x73\145\x72\x5f\x69\144"])) { header("\114\157\x63\x61\x74\151\x6f\x6e\x3a\40\154\x6f\147\x69\156\x2e\x70\x68\x70"); die; } goto J6toS; RirCU: ?>
</select></div></div><div class="modal-footer"><button class="btn btn-secondary"type="button"data-bs-dismiss="modal">İptal</button> <button class="btn btn-primary"type="submit">Kaydet</button></div></form></div></div></div><div class="fade modal"id="editDepartmentModal"aria-hidden="true"aria-labelledby="editDepartmentModalLabel"tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"id="editDepartmentModalLabel">Departman Düzenle</h5><button class="btn-close"type="button"data-bs-dismiss="modal"aria-label="Close"></button></div><form action=""method="post"><div class="modal-body"><input name="action"type="hidden"value="edit"> <input name="old_department_name"type="hidden"id="old_department_name"><div class="mb-3"><label class="form-label"for="edit_department_name">Departman Adı</label> <input name="department_name"id="edit_department_name"class="form-control"required></div><div class="mb-3"><label class="form-label"for="edit_manager_id">Departman Yöneticisi</label> <select class="form-select"id="edit_manager_id"name="manager_id"required><option value="">Yönetici Seçin</option><?php  goto U_QIk; zNjdI: if ($userRole == "\141\x64\x6d\151\x6e") { echo "\304\xb0\113\x20\x59\303\266\156\145\x74\x69\143\x69\163\x69"; } else { if ($userRole == "\155\141\x6e\141\147\x65\162") { echo "\x42\x69\x72\151\x6d\x20\x4d\xc3\xbc\x64\303\274\162\xc3\xbc"; } else { echo "\120\145\x72\163\x6f\156\x65\x6c"; } } goto t3AT7; ilvtK: $employees = array(); goto zCjkD; vxpNi: foreach ($managers as $manager) { ?>
<option value="<?php  echo $manager["\151\144"]; ?>
"><?php  echo $manager["\156\141\155\145"]; ?>
(<?php  echo $manager["\x70\157\x73\x69\x74\151\157\156"]; ?>
)</option><?php  } goto RirCU; obEr1: ?>
</select></div></div><div class="modal-footer"><button class="btn btn-secondary"type="button"data-bs-dismiss="modal">İptal</button> <button class="btn btn-primary"type="submit">Kaydet</button></div></form></div></div></div><div class="fade modal"id="deleteDepartmentModal"aria-hidden="true"aria-labelledby="deleteDepartmentModalLabel"tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"id="deleteDepartmentModalLabel">Departman Sil</h5><button class="btn-close"type="button"data-bs-dismiss="modal"aria-label="Close"></button></div><form action=""method="post"><div class="modal-body"><input name="action"type="hidden"value="delete"> <input name="department_name"type="hidden"id="delete_department_name"><p>Bu departmanı silmek istediğinizden emin misiniz?</p><p><strong>Departman:</strong> <span id="delete-department-name"></span></p><p><strong>Çalışan Sayısı:</strong> <span id="delete-employee-count"></span></p><div class="alert alert-warning"id="delete-warning"style="display:none">Bu departmanda çalışanlar var. Önce çalışanları başka departmanlara aktarın veya silin.</div></div><div class="modal-footer"><button class="btn btn-secondary"type="button"data-bs-dismiss="modal">İptal</button> <button class="btn btn-danger"type="submit"id="delete-confirm-btn">Sil</button></div></form></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><script src="js/main.js"></script><script src="js/department_management.js"></script></body></html>