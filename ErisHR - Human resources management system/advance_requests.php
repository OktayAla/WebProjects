<?php
 goto xmYWD; SQpzE: if ($userRole == "\x61\x64\155\x69\156") { echo "\304\260\x4b\x20\x59\303\xb6\156\x65\x74\x69\x63\x69\x73\x69"; } else { if ($userRole == "\x6d\141\156\141\147\x65\x72") { echo "\x42\151\x72\x69\155\40\115\xc3\xbc\144\xc3\274\x72\303\xbc"; } else { echo "\x50\145\x72\163\157\x6e\145\x6c"; } } goto eyW7B; Y6cTx: ?>
<div class="col-12 text-end"><button class="btn btn-secondary me-2"type="button"id="resetFilter"><i class="fas me-2 fa-undo"></i>Sıfırla</button> <button class="btn btn-primary"type="button"id="applyFilter"><i class="fas me-2 fa-filter"></i>Uygula</button></div></form></div></div></div><div class="advance-requests-list"><?php  goto vx7Qb; zc2TE: ?>
<!doctypehtml><html lang="tr"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>HRMS - Avans Talepleri</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"rel="stylesheet"><link href="css/style.css"rel="stylesheet"></head><body><div class="app-container"><aside class="sidebar"><div class="sidebar-header"><img alt="HRMS Logo"src="img/logo.png"class="logo"><h3>HRMS</h3></div><div class="user-info"><div class="user-avatar"><img alt="User Avatar"src="img/avatars/default.png"></div><div class="user-details"><h4><?php  goto NJGsC; JXRz_: ?>
</ul></nav><div class="sidebar-footer"><a href="profile.php"><i class="fas fa-user-circle"></i> Profil</a> <a href="logout.php"><i class="fas fa-sign-out-alt"></i> Çıkış</a></div></aside><main class="main-content"><header class="header"><div class="header-left"><button class="sidebar-toggle"id="sidebar-toggle"><i class="fas fa-bars"></i></button><h2>Avans Talepleri</h2></div><div class="header-right"><div class="notification"><i class="fas fa-bell"></i> <span class="badge">3</span></div><div class="date-time"><span id="current-date"></span> <span id="current-time"></span></div></div></header><div class="content-wrapper"><div class="advance-requests-page animate__animated animate__fadeIn"><?php  goto yidQB; OE1zv: if (!isset($_SESSION["\165\163\x65\162\x5f\151\144"])) { header("\x4c\157\x63\x61\x74\151\157\x6e\72\40\154\x6f\147\151\156\56\x70\x68\160"); die; } goto CUwDO; sRyOK: ?>
<div class="mb-4 row"><div class="col-md-4"><div class="card"><div class="card-header"><h5><i class="fas me-2 fa-info-circle"></i>Avans Bilgileri</h5></div><div class="card-body"><div class="advance-info"><p class="mb-4">Avans talepleri, acil durumlarda veya özel ihtiyaçlar için çalışanlara finansal destek sağlamak amacıyla kullanılır. Talepleriniz ilgili yöneticiniz tarafından değerlendirilecektir.</p><button class="btn btn-primary w-100"data-bs-target="#newAdvanceRequestModal"data-bs-toggle="modal"><i class="fas me-2 fa-plus-circle"></i>Yeni Avans Talebi</button></div></div></div></div><div class="col-md-8"><div class="card"><div class="card-header"><h5><i class="fas me-2 fa-chart-line"></i>Avans İstatistikleri</h5></div><div class="card-body"><div class="row"><div class="col-md-4"><div class="stat-item"><div class="stat-icon bg-primary"><i class="fas fa-money-bill-wave"></i></div><div class="stat-info"><h5>Toplam Avans</h5><p id="total-advance">Hesaplanıyor...</p></div></div></div><div class="col-md-4"><div class="stat-item"><div class="stat-icon bg-success"><i class="fas fa-check-circle"></i></div><div class="stat-info"><h5>Onaylanan</h5><p id="approved-advance">Hesaplanıyor...</p></div></div></div><div class="col-md-4"><div class="stat-item"><div class="stat-icon bg-warning"><i class="fas fa-clock"></i></div><div class="stat-info"><h5>Bekleyen</h5><p id="pending-advance">Hesaplanıyor...</p></div></div></div></div></div></div></div></div><div class="card"><div class="card-header align-items-center d-flex justify-content-between"><h5><i class="fas me-2 fa-list"></i>Avans Taleplerim</h5><div class="header-actions"><button class="btn btn-sm btn-outline-primary"id="filterButton"><i class="fas me-2 fa-filter"></i>Filtrele</button></div></div><div class="card-body"><div class="mb-4 filter-panel"style="display:none"><div class="card"><div class="card-body"><form class="row g-3"id="filterForm"><div class="col-md-4"><label class="form-label"for="filterStatus">Durum</label> <select class="form-select"id="filterStatus"><option value="">Tümü</option><option value="pending">Beklemede</option><option value="approved">Onaylandı</option><option value="rejected">Reddedildi</option></select></div><div class="col-md-4"><label class="form-label"for="filterAmount">Tutar</label> <select class="form-select"id="filterAmount"><option value="">Tümü</option><option value="0-1000">0 - 1.000 ₺</option><option value="1000-3000">1.000 - 3.000 ₺</option><option value="3000+">3.000 ₺ ve üzeri</option></select></div><?php  goto jz2qQ; vx7Qb: if (empty($advanceRequests)) { ?>
<div class="py-5 text-center"><i class="fas fa-money-bill-wave fa-4x mb-3 text-muted"></i><h5 class="text-muted">Henüz avans talebi bulunmuyor.</h5><p class="text-muted">Yeni bir avans talebi oluşturmak için "Yeni Avans Talebi" butonuna tıklayın.</p></div><?php  } else { foreach ($advanceRequests as $request) { ?>
<div class="advance-request-card"data-amount="<?php  echo $request["\x61\x6d\x6f\165\x6e\164"]; ?>
"data-employee="<?php  echo $request["\145\155\160\154\157\171\x65\x65\137\x69\x64"]; ?>
"data-status="<?php  echo $request["\163\164\141\x74\x75\x73"]; ?>
"><div class="advance-request-header"><h5 class="advance-request-title"><?php  echo number_format($request["\x61\x6d\x6f\x75\156\x74"], 2, "\x2c", "\56"); ?>
₺</h5><span class="advance-request-status status-<?php  echo $request["\163\164\141\164\x75\163"]; ?>
"><?php  $statusLabels = array("\x70\145\x6e\144\151\x6e\x67" => "\102\145\153\154\x65\x6d\145\x64\x65", "\141\x70\160\x72\x6f\166\x65\144" => "\x4f\156\x61\x79\154\x61\x6e\x64\xc4\261", "\162\x65\152\x65\x63\164\x65\x64" => "\122\145\144\144\x65\144\151\x6c\x64\151"); echo $statusLabels[$request["\163\164\x61\x74\x75\163"]] ?? $request["\x73\164\141\x74\x75\163"]; ?>
</span></div><?php  if ($userRole === "\141\144\x6d\151\156" || $userRole === "\x6d\141\x6e\x61\147\x65\x72") { ?>
<div class="mb-3 advance-request-employee"><h5>Personel</h5><p><?php  echo $request["\x65\x6d\160\154\157\x79\x65\x65\x5f\x6e\x61\155\145"]; ?>
(<?php  echo $request["\x64\x65\x70\x61\x72\x74\155\x65\x6e\x74"]; ?>
)</p></div><?php  } ?>
<div class="advance-request-reason"><h5>Avans Nedeni</h5><p><?php  echo $request["\162\145\141\x73\x6f\156"]; ?>
</p></div><?php  if ($request["\x73\x74\141\x74\165\163"] === "\141\x70\160\x72\157\166\145\144" && !empty($request["\160\141\x79\155\x65\x6e\164\137\x64\141\164\x65"])) { ?>
<div class="advance-request-payment"><h5>Ödeme Tarihi</h5><p><?php  echo date("\144\56\x6d\56\131", strtotime($request["\160\x61\171\155\145\x6e\164\x5f\144\x61\x74\145"])); ?>
</p></div><?php  } ?>
<div class="advance-request-info"><small class="text-muted">Talep Tarihi:<?php  echo date("\144\x2e\155\56\x59\x20\x48\72\151", strtotime($request["\x63\162\145\141\164\x65\x64\137\141\x74"])); ?>
</small><?php  if ($request["\x73\164\x61\x74\x75\163"] !== "\x70\145\x6e\144\x69\156\147") { ?>
<small class="text-muted ms-3"><?php  echo $request["\163\x74\x61\x74\165\163"] === "\x61\x70\x70\162\x6f\166\x65\x64" ? "\x4f\156\x61\x79\154\141\156\x6d\x61" : "\122\145\x64\x64\x65\144\151\x6c\155\145"; ?>
Tarihi:<?php  echo date("\x64\56\x6d\56\131\40\110\x3a\x69", strtotime($request["\x61\160\x70\162\x6f\x76\145\x64\137\x64\x61\x74\145"])); ?>
</small><?php  } ?>
</div><div class="advance-request-actions"><?php  if ($request["\x73\x74\x61\x74\165\163"] === "\x70\145\156\144\x69\x6e\x67") { if ($userRole === "\x61\144\x6d\x69\x6e" || $userRole === "\x6d\x61\x6e\141\147\145\x72" && $request["\x64\x65\160\x61\x72\164\155\x65\x6e\x74"] === $userDepartment) { ?>
<form action=""method="post"class="d-inline"><input name="action"type="hidden"value="approve"> <input name="request_id"type="hidden"value="<?php  echo $request["\x69\144"]; ?>
"> <button class="btn btn-sm btn-success"type="submit"><i class="fas me-1 fa-check"></i> Onayla</button></form><form action=""method="post"class="d-inline"><input name="action"type="hidden"value="reject"> <input name="request_id"type="hidden"value="<?php  echo $request["\151\x64"]; ?>
"> <button class="btn btn-sm btn-danger"type="submit"><i class="fas me-1 fa-times"></i> Reddet</button></form><?php  } if ($request["\x65\155\160\154\157\x79\145\145\x5f\151\x64"] == $userId) { ?>
<form action=""method="post"class="d-inline"><input name="action"type="hidden"value="delete"> <input name="request_id"type="hidden"value="<?php  echo $request["\151\x64"]; ?>
"> <button class="btn btn-sm btn-outline-danger"type="submit"onclick='return confirm("Bu avans talebini silmek istediğinize emin misiniz?")'><i class="fas me-1 fa-trash"></i> Sil</button></form><?php  } } elseif ($userRole === "\x61\144\x6d\x69\156") { ?>
<form action=""method="post"class="d-inline"><input name="action"type="hidden"value="delete"> <input name="request_id"type="hidden"value="<?php  echo $request["\x69\x64"]; ?>
"> <button class="btn btn-sm btn-outline-danger"type="submit"onclick='return confirm("Bu avans talebini silmek istediğinize emin misiniz?")'><i class="fas me-1 fa-trash"></i> Sil</button></form><?php  } ?>
</div></div><?php  } } goto vy1lg; qmFB3: $successMessage = ''; goto VW0jq; CUwDO: $userId = $_SESSION["\165\163\145\x72\137\151\144"]; goto KCCYn; r6NC6: if ($userRole == "\141\144\155\151\156") { ?>
<li><a href="employee_management.php"><i class="fas fa-user-cog"></i> Personel Yönetimi</a></li><li><a href="department_management.php"><i class="fas fa-building"></i> Departman Yönetimi</a></li><li><a href="card_management.php"><i class="fas fa-id-card"></i> Kart Yönetimi</a></li><li><a href="reports.php"><i class="fas fa-chart-bar"></i> Raporlar</a></li><?php  } goto JXRz_; yidQB: if (!empty($successMessage)) { ?>
<div class="fade alert alert-dismissible show alert-success"role="alert"><i class="fas me-2 fa-check-circle"></i><?php  echo $successMessage; ?>
<button class="btn-close"type="button"data-bs-dismiss="alert"aria-label="Close"></button></div><?php  } goto LaiTE; VW0jq: $errorMessage = ''; goto w8r2y; B4k20: ?>
</h4><p><?php  goto SQpzE; NJGsC: echo $userName; goto B4k20; lbFr0: $advanceRequests = array(); goto wx6Jc; LaiTE: if (!empty($errorMessage)) { ?>
<div class="fade alert alert-dismissible show alert-danger"role="alert"><i class="fas me-2 fa-exclamation-circle"></i><?php  echo $errorMessage; ?>
<button class="btn-close"type="button"data-bs-dismiss="alert"aria-label="Close"></button></div><?php  } goto sRyOK; lUWhf: $advanceRequestsFile = "\x64\x61\x74\141\57\x61\x64\166\141\x6e\x63\145\x5f\x72\x65\161\x75\145\x73\x74\163\56\152\163\x6f\156"; goto lbFr0; xmYWD: session_start(); goto OE1zv; EtCMy: if ($userRole == "\155\x61\156\x61\x67\145\x72") { ?>
<li><a href="team_management.php"><i class="fas fa-users"></i> Ekip Yönetimi</a></li><li><a href="approval_requests.php"><i class="fas fa-tasks"></i> Onay Bekleyen Talepler</a></li><?php  } goto r6NC6; eyW7B: ?>
</p></div></div><nav class="sidebar-nav"><ul><li><a href="index.php"><i class="fas fa-home"></i> Ana Sayfa</a></li><li><a href="attendance.php"><i class="fas fa-clock"></i> Giriş/Çıkış Kayıtları</a></li><li><a href="leave_requests.php"><i class="fas fa-calendar-alt"></i> İzin Talepleri</a></li><li><a href="advance_requests.php"class="active"><i class="fas fa-money-bill-wave"></i> Avans Talepleri</a></li><?php  goto EtCMy; nbXeE: $userDepartment = $_SESSION["\144\x65\160\141\x72\x74\155\x65\156\164"]; goto qmFB3; w8r2y: if ($_SERVER["\x52\x45\x51\125\x45\123\x54\137\x4d\x45\x54\x48\x4f\x44"] == "\120\117\x53\124") { $action = isset($_POST["\141\x63\x74\151\x6f\156"]) ? $_POST["\x61\143\x74\x69\157\156"] : ''; $advanceRequestsFile = "\x64\141\164\141\57\141\144\166\x61\x6e\x63\x65\x5f\x72\145\161\165\145\x73\164\163\x2e\152\x73\157\x6e"; $advanceRequests = array(); if (file_exists($advanceRequestsFile)) { $advanceRequests = json_decode(file_get_contents($advanceRequestsFile), true); } if ($action === "\143\x72\x65\141\164\x65") { $amount = $_POST["\x61\155\x6f\x75\x6e\x74"]; $reason = $_POST["\x72\x65\x61\x73\x6f\x6e"]; $employeesFile = "\144\x61\x74\141\x2f\x65\155\160\x6c\157\171\x65\145\x73\x2e\152\163\x6f\156"; $employees = array(); $employeeName = $userName; $employeeDepartment = $userDepartment; if (file_exists($employeesFile)) { $employees = json_decode(file_get_contents($employeesFile), true); foreach ($employees as $employee) { if ($employee["\151\x64"] == $userId) { $employeeName = $employee["\x6e\x61\x6d\145"]; $employeeDepartment = $employee["\x64\x65\160\x61\162\164\155\145\156\x74"]; break; } } } $newRequest = array("\151\144" => "\141\162" . uniqid(), "\145\x6d\160\154\157\171\x65\145\137\x69\x64" => $userId, "\145\x6d\160\x6c\x6f\171\x65\145\x5f\156\x61\155\x65" => $employeeName, "\144\x65\x70\x61\162\x74\155\145\x6e\164" => $employeeDepartment, "\141\155\157\165\x6e\x74" => (double) $amount, "\162\145\141\x73\157\156" => $reason, "\163\164\141\x74\x75\163" => "\160\145\156\x64\x69\x6e\147", "\x61\x70\160\162\x6f\166\x65\144\137\x62\x79" => null, "\141\160\x70\x72\x6f\x76\145\144\x5f\144\141\x74\x65" => null, "\160\141\x79\x6d\x65\x6e\164\137\144\141\x74\x65" => null, "\x63\x72\x65\x61\164\x65\x64\137\141\x74" => date("\131\55\x6d\55\144\40\x48\72\x69\x3a\163")); $advanceRequests[] = $newRequest; file_put_contents($advanceRequestsFile, json_encode($advanceRequests, JSON_PRETTY_PRINT)); $successMessage = "\101\166\x61\156\x73\40\x74\141\154\145\142\151\156\151\172\x20\142\141\xc5\x9f\141\x72\304\xb1\x79\154\141\40\157\x6c\165\xc5\237\x74\165\x72\x75\x6c\x64\165\56"; } elseif ($action === "\x61\x70\160\x72\x6f\166\145" || $action === "\162\x65\152\x65\x63\x74") { if ($userRole !== "\155\x61\x6e\x61\147\x65\162" && $userRole !== "\141\144\155\151\156") { $errorMessage = "\102\x75\40\151\xc5\x9f\x6c\145\155\151\x20\147\145\162\xc3\xa7\x65\153\x6c\145\xc5\x9f\164\151\162\x6d\145\x6b\x20\x69\303\247\x69\x6e\40\171\145\164\153\x69\x6e\151\172\x20\171\157\153\56"; } else { $requestId = $_POST["\x72\145\x71\165\145\x73\x74\137\151\144"]; $requestFound = false; foreach ($advanceRequests as &$request) { if ($request["\x69\x64"] === $requestId) { if ($userRole === "\155\x61\156\x61\147\145\x72" && $request["\x64\145\160\x61\x72\x74\x6d\x65\156\x74"] !== $userDepartment) { $errorMessage = "\123\141\x64\x65\x63\145\x20\x6b\x65\156\144\151\40\x64\x65\x70\141\x72\164\x6d\x61\x6e\xc4\xb1\x6e\xc4\xb1\172\x64\141\153\x69\x20\x74\x61\x6c\145\x70\154\145\162\151\x20\157\x6e\141\171\x6c\x61\171\x61\x62\x69\154\x69\x72\163\x69\156\151\x7a\56"; break; } $request["\x73\164\141\164\x75\163"] = $action === "\x61\160\x70\x72\x6f\166\145" ? "\141\x70\x70\162\157\166\145\144" : "\162\145\x6a\145\x63\164\x65\x64"; $request["\x61\x70\x70\162\x6f\166\145\x64\137\142\x79"] = $userId; $request["\141\x70\160\162\x6f\x76\x65\x64\x5f\x64\141\x74\x65"] = date("\x59\55\155\55\144\40\110\72\151\72\163"); if ($action === "\x61\160\160\x72\x6f\x76\145") { $paymentDate = new DateTime(); $paymentDate->add(new DateInterval("\120\x33\x44")); $request["\160\x61\171\155\x65\x6e\x74\137\x64\141\x74\145"] = $paymentDate->format("\131\x2d\155\55\144"); } $requestFound = true; break; } } if ($requestFound) { file_put_contents($advanceRequestsFile, json_encode($advanceRequests, JSON_PRETTY_PRINT)); $successMessage = "\101\166\141\x6e\163\40\x74\x61\x6c\145\x62\x69\x20\142\x61\xc5\x9f\141\x72\xc4\261\171\x6c\x61\x20" . ($action === "\x61\x70\x70\x72\157\x76\145" ? "\157\x6e\x61\x79\x6c\x61\156\144\xc4\xb1" : "\x72\x65\x64\144\145\144\151\x6c\x64\x69") . "\x2e"; } else { $errorMessage = "\x41\166\141\x6e\163\x20\x74\x61\154\145\x62\151\40\142\165\154\165\x6e\x61\155\x61\144\xc4\xb1\56"; } } } elseif ($action === "\144\x65\x6c\145\x74\145") { $requestId = $_POST["\162\145\x71\x75\x65\163\164\137\x69\x64"]; $requestIndex = -1; foreach ($advanceRequests as $index => $request) { if ($request["\x69\x64"] === $requestId) { if ($userRole === "\141\144\155\151\x6e" || $request["\x65\155\x70\154\x6f\171\x65\145\137\151\144"] == $userId && $request["\x73\x74\x61\x74\x75\x73"] === "\x70\x65\x6e\x64\151\156\x67") { $requestIndex = $index; } else { $errorMessage = "\x42\x75\x20\x74\x61\x6c\x65\142\151\40\163\151\154\155\145\153\40\151\xc3\xa7\x69\x6e\x20\x79\145\x74\x6b\151\x6e\151\x7a\x20\x79\157\153\56"; } break; } } if ($requestIndex >= 0) { array_splice($advanceRequests, $requestIndex, 1); file_put_contents($advanceRequestsFile, json_encode($advanceRequests, JSON_PRETTY_PRINT)); $successMessage = "\x41\166\x61\x6e\x73\x20\164\x61\154\145\142\x69\40\142\141\305\x9f\141\162\xc4\261\x79\154\141\x20\163\151\154\x69\x6e\144\151\x2e"; } else { if (empty($errorMessage)) { $errorMessage = "\101\x76\x61\x6e\163\40\x74\141\x6c\x65\x62\x69\x20\142\165\154\165\x6e\141\155\141\144\xc4\261\x2e"; } } } } goto lUWhf; KCCYn: $userName = $_SESSION["\156\x61\155\x65"]; goto Jr2lL; jz2qQ: if ($userRole === "\x61\x64\x6d\151\x6e" || $userRole === "\155\x61\x6e\141\147\x65\162") { ?>
<div class="col-md-4"><label class="form-label"for="filterEmployee">Personel</label> <select class="form-select"id="filterEmployee"><option value="">Tümü</option></select></div><?php  } goto Y6cTx; Jr2lL: $userRole = $_SESSION["\162\x6f\154\145"]; goto nbXeE; wx6Jc: if (file_exists($advanceRequestsFile)) { $allRequests = json_decode(file_get_contents($advanceRequestsFile), true); if ($userRole === "\x61\x64\155\151\x6e") { $advanceRequests = $allRequests; } elseif ($userRole === "\x6d\x61\x6e\x61\x67\145\162") { foreach ($allRequests as $request) { if ($request["\144\145\160\141\x72\x74\155\145\156\x74"] === $userDepartment) { $advanceRequests[] = $request; } } } else { foreach ($allRequests as $request) { if ($request["\x65\x6d\160\x6c\x6f\171\145\x65\137\x69\144"] == $userId) { $advanceRequests[] = $request; } } } usort($advanceRequests, function ($a, $b) { return strtotime($b["\x63\162\145\x61\x74\x65\144\137\141\x74"]) - strtotime($a["\x63\162\x65\141\164\x65\144\x5f\141\164"]); }); } goto zc2TE; vy1lg: ?>
</div></div></div></div></div></main></div><div class="fade modal"aria-hidden="true"aria-labelledby="newAdvanceRequestModalLabel"id="newAdvanceRequestModal"tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"id="newAdvanceRequestModalLabel">Yeni Avans Talebi</h5><button class="btn-close"type="button"data-bs-dismiss="modal"aria-label="Close"></button></div><div class="modal-body"><form action=""method="post"id="advanceRequestForm"><input name="action"type="hidden"value="create"><div class="mb-3"><label class="form-label"for="amount">Avans Tutarı (₺)</label> <input name="amount"type="number"class="form-control"id="amount"min="100"required step="100"><div class="form-text">Talep etmek istediğiniz avans tutarını giriniz.</div></div><div class="mb-3"><label class="form-label"for="reason">Avans Nedeni</label> <textarea class="form-control"id="reason"name="reason"required rows="4"></textarea><div class="form-text">Avans talebinizin nedenini detaylı bir şekilde açıklayınız.</div></div></form></div><div class="modal-footer"><button class="btn btn-secondary"type="button"data-bs-dismiss="modal">İptal</button> <button class="btn btn-primary"type="submit"form="advanceRequestForm">Talep Oluştur</button></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script src="js/main.js"></script><script src="js/advance_requests.js"></script></body></html>