<?php
 goto CyRnL; wx0Se: if (!function_exists("\143\x73\162\x66\137\x74\157\x6b\x65\156")) { function csrf_token() { if (empty($_SESSION["\x63\x73\x72\x66\x5f\x74\157\x6b\145\156"])) { $_SESSION["\143\x73\x72\146\137\164\x6f\153\x65\156"] = bin2hex(random_bytes(32)); } return $_SESSION["\x63\163\162\146\x5f\x74\157\x6b\145\x6e"]; } } goto kPqcu; qa6LB: function users_count() { $pdo = get_pdo_connection(); return (int) $pdo->query("\123\x45\114\x45\103\124\x20\x43\117\x55\x4e\124\x28\52\x29\40\106\x52\x4f\115\40\x6b\165\x6c\x6c\x61\156\x69\143\x69\154\141\162")->fetchColumn(); } goto MMqHL; j5Xs6: function login($identifier, $password) { $pdo = get_pdo_connection(); $hasUsername = false; try { $colStmt = $pdo->query("\x53\x45\x4c\x45\x43\x54\x20\x31\40\x46\122\117\115\40\111\116\x46\x4f\x52\115\x41\124\111\x4f\x4e\137\x53\x43\110\x45\x4d\101\x2e\103\117\x4c\125\115\x4e\123\40\x57\x48\x45\x52\105\x20\124\x41\102\114\105\x5f\123\103\x48\x45\115\x41\x20\75\40\x44\101\124\101\x42\101\123\105\x28\x29\x20\x41\x4e\104\40\x54\101\102\114\105\x5f\116\x41\115\x45\40\75\x20\47\x6b\165\x6c\x6c\141\x6e\151\x63\x69\x6c\141\x72\47\40\x41\116\104\40\103\117\114\x55\x4d\x4e\137\116\x41\115\105\x20\x3d\x20\47\x75\163\145\x72\156\x61\155\145\47\40\114\x49\x4d\x49\124\x20\61"); $hasUsername = (bool) $colStmt->fetchColumn(); } catch (Exception $e) { $hasUsername = false; } $user = null; if ($hasUsername) { $stmt = $pdo->prepare("\x53\x45\x4c\x45\103\x54\x20\x69\144\54\x20\x69\163\x69\x6d\54\40\x65\160\x6f\x73\164\x61\x2c\40\x75\163\145\x72\x6e\x61\x6d\145\54\40\163\151\146\x72\x65\54\x20\x72\157\x6c\x20\106\122\117\115\40\x6b\165\154\154\141\156\151\x63\151\154\141\162\x20\127\110\105\x52\105\40\165\x73\145\162\156\x61\x6d\145\x20\75\x20\77\40\x4c\111\x4d\111\124\x20\61"); $stmt->execute(array($identifier)); $user = $stmt->fetch(); if (!$user) { $stmt = $pdo->prepare("\123\105\x4c\x45\103\124\40\x69\144\x2c\x20\x69\x73\x69\155\x2c\x20\145\x70\157\x73\x74\141\54\40\165\x73\x65\x72\x6e\141\x6d\145\x2c\40\163\x69\x66\162\145\54\40\162\x6f\x6c\40\x46\122\117\x4d\x20\x6b\165\154\x6c\x61\x6e\151\x63\151\154\141\162\x20\x57\110\105\x52\105\x20\145\160\x6f\163\164\141\x20\75\x20\77\x20\114\x49\x4d\x49\x54\40\61"); $stmt->execute(array($identifier)); $user = $stmt->fetch(); if (!$user) { $stmt = $pdo->prepare("\123\105\x4c\105\x43\x54\x20\x69\144\x2c\40\151\163\x69\155\54\40\x65\x70\157\x73\x74\141\54\40\x75\163\145\162\156\141\x6d\x65\54\x20\163\151\146\x72\145\x2c\x20\x72\157\154\x20\x46\x52\117\x4d\x20\x6b\165\154\154\x61\156\151\143\x69\154\141\x72\40\x57\110\x45\x52\x45\40\151\163\x69\155\40\x3d\x20\x3f\x20\114\111\x4d\x49\x54\x20\x31"); $stmt->execute(array($identifier)); $user = $stmt->fetch(); } } } else { $stmt = $pdo->prepare("\x53\105\x4c\105\103\124\x20\x69\144\54\40\151\163\151\x6d\x2c\40\145\x70\157\163\164\141\54\x20\x73\x69\146\162\145\54\40\x72\157\x6c\x20\x46\122\x4f\115\40\x6b\165\x6c\x6c\141\x6e\151\x63\151\x6c\141\162\x20\127\110\x45\x52\105\40\145\x70\x6f\163\x74\141\40\75\40\77\x20\114\111\115\111\124\40\61"); $stmt->execute(array($identifier)); $user = $stmt->fetch(); if (!$user) { $stmt = $pdo->prepare("\123\105\x4c\x45\x43\124\x20\x69\144\54\40\151\163\151\x6d\54\x20\145\160\x6f\x73\164\x61\x2c\40\x73\x69\x66\x72\x65\54\x20\162\x6f\154\40\106\122\x4f\x4d\x20\153\x75\154\154\141\x6e\151\x63\x69\x6c\141\x72\40\127\110\105\x52\x45\40\x69\x73\x69\155\x20\x3d\x20\77\40\x4c\111\115\x49\x54\40\x31"); $stmt->execute(array($identifier)); $user = $stmt->fetch(); } } if (!$user) { return false; } $hash = $user["\x73\151\x66\162\x65"]; $verified = false; if (strpos($hash, "\44\62\x79\44") === 0 || strpos($hash, "\44\x61\162\x67\x6f\x6e\62") === 0) { $verified = password_verify($password, $hash); } else { $verified = hash_equals($hash, $password); } if ($verified) { unset($user["\163\151\146\162\x65"]); $_SESSION["\165\163\x65\x72"] = $user; return true; } return false; } goto E6U9h; E6U9h: function logout() { $_SESSION = array(); if (ini_get("\x73\x65\x73\163\151\x6f\156\x2e\x75\163\145\137\x63\157\x6f\x6b\151\x65\163")) { $params = session_get_cookie_params(); setcookie(session_name(), '', time() - 42000, $params["\160\141\x74\150"], $params["\x64\x6f\x6d\141\x69\156"], $params["\163\145\143\x75\x72\145"], $params["\x68\164\x74\160\157\156\154\x79"]); } session_destroy(); } goto QDKT2; kPqcu: if (!function_exists("\166\145\162\x69\x66\x79\x5f\x63\x73\162\146")) { function verify_csrf($token) { return isset($_SESSION["\143\x73\162\x66\137\164\157\x6b\145\x6e"]) && is_string($token) && hash_equals($_SESSION["\143\163\162\x66\137\164\157\x6b\145\x6e"], $token); } } goto qa6LB; OWBrW: function require_login() { if (!current_user()) { header("\x4c\x6f\x63\x61\x74\x69\x6f\x6e\x3a\40\x67\x69\162\151\x73\56\x70\150\160"); die; } } goto j5Xs6; CyRnL: session_start(); goto Zrid3; Zrid3: require_once __DIR__ . "\57\144\142\x2e\x70\150\x70"; goto wx0Se; MMqHL: function current_user() { return isset($_SESSION["\x75\163\x65\162"]) ? $_SESSION["\165\163\x65\162"] : null; } goto OWBrW; QDKT2: ?>